<section class="dbpo-request">
  <div class="container">
    {{#contains user.tags settings.internal_tag}}
      <h1>Internal support request</h1>
      <p class="dbpo-request-intro">
        You're signed in as Digify staff, so only internal ticket forms are available below.
      </p>
    {{else}}
      {{#contains user.organizations settings.internal_org_id}}
        <h1>Internal support request</h1>
        <p class="dbpo-request-intro">
          You're signed in under the internal organization, so tenant-only forms are hidden.
        </p>
      {{else}}
        {{#contains user.tags settings.tenant_tag}}
          <h1>Tenant request centre</h1>
          <p class="dbpo-request-intro">
            You're viewing the tenant portal. Only the tenant ticket form remains in the dropdown.
          </p>
        {{else}}
          {{#contains user.organizations settings.tenant_org_id}}
            <h1>Tenant request centre</h1>
            <p class="dbpo-request-intro">
              You're associated with a tenant organization, so internal-only forms are hidden.
            </p>
          {{else}}
            <h1>{{t 'submit_a_request'}}</h1>
            <p class="dbpo-request-intro">
              Not sure which form to use? Choose internal staff if you work for Digify. External partners should use the tenant request option.
            </p>
            <div class="btn-group gap-2 mb-4">
              <a class="btn btn-primary" href="{{page_path 'new_request'}}?ticket_form_id={{#if settings.internal_form_id}}{{settings.internal_form_id}}{{else}}23590656709788{{/if}}">
                Request internal access
              </a>
              <a class="btn btn-outline-primary" href="{{page_path 'new_request'}}?ticket_form_id={{#if settings.tenant_form_id}}{{settings.tenant_form_id}}{{else}}23590702845724{{/if}}">
                Request tenant access
              </a>
            </div>
          {{/contains}}
        {{/contains}}
      {{/contains}}
    {{/contains}}
    {{#if settings.request_form_icon_url}}
      <img class="dbpo-request-icon" src="{{settings.request_form_icon_url}}" alt="" role="presentation">
    {{/if}}
    <div id="new-request-form"></div>
  </div>
</section>

<script type="module">
  import { renderNewRequestForm } from "new-request-form";

  const container = document.getElementById("new-request-form");

  const settings = {{json settings}};

  const props = {
    requestForm: {{json new_request_form}},
    newRequestPath: {{json (page_path 'new_request')}},
    parentId: {{json parent.id}},
    parentIdPath: {{json parent.url}},
    locale: {{json help_center.locale}},
    baseLocale: {{json help_center.base_locale}},
    hasAtMentions: {{json help_center.at_mentions_enabled}},
    userRole: {{json user.role}},
    userId: {{json user.id}},
    brandId: {{json brand.id}},
    organizations: {{json user.organizations}},
    wysiwyg: true,
    answerBotModal: {
      answerBot: {{json answer_bot}},
      hasRequestManagement: {{json help_center.request_management_enabled}},
      isSignedIn: {{json signed_in}},
      helpCenterPath: {{json (page_path 'help_center')}},
      requestsPath: {{json (page_path 'requests')}},
      requestPath: {{json (page_path 'request' id=answer_bot.request_id)}}
    },
  };

  renderNewRequestForm(settings, props, container);
</script>
